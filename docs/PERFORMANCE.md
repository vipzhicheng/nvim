# 性能问题

`Vim` 尤其是新手，比如说我，在使用过程中会经历添加配置，添加键绑定和添加插件，然后各种自定义小功能的过程。每一个功能的体验和实现都让我们惊喜，但是渐渐的就会发现 越来越卡了。

刚遇到这个问题的时候完全摸不到头脑，但是经过一番探索，还是解决了问题，这里记录和分享一下，希望大家少走弯路。

## 对性能问题进行分类

有一些性能问题是核心配置带来的，而有一些则是插件带来的。有一些性能问题是插件已知问题，需要额外的配置（可能刚开始安装时没有自己看 README），还有一些是插件固有问题，装上就肯定会慢，看你要功能还是性能了，要性能就卸载掉，再找替代品吧。

## 性能问题的识别

* 启动慢
* 光标移动卡顿延迟

对于启动慢的问题，可以通过

```
vim --startuptime vim.log
cat vim.log|less
```

看有没有消耗特别大的启动时间的插件被加载了。如果大家用的都是主流的插件，一般不会发现特别明显的问题，还得具体问题具体分析。

我遇到的问题主要是光标移动延迟

## 对于光标移动延迟问题的分析和记录

### 现象

在行内移动和跨行移动式不是很顺滑，不管是长按还是短按都有明显延迟卡顿。
这是一个综合现象，跟很多地方都有关系，有些需要取舍，有些可以优化。具体原理还不是很清楚，但是有效果。

### 调节配置

#### 基本配置

* `set lazyredraw`
* `set ttyfast`

#### 一些之前喜欢的配置

* `set cursorline`
* `set cursorcolumn`
* `set relativenumber`

这几项之前觉得挺好，但是发现对光标移动有一定影响，所以我决定以后需要时手动开启。

#### 关闭代码折叠

经过测试，发现代码折叠对延迟影响非常大，机器性能不佳的化，可以不要开了。

#### 插件的影响

再做了各种尝试之后，虽然已经好了不少，但是还是有问题，对比不加载任何配置的延迟还是差了好多。就剩下最后一招，用二分法，关闭部分插件，以此看对延迟的影响，最后还真让我找到一个，`airline`。

但是当我去看插件文档时，发现插件作者已经说了这种影响，以及如何应对，我只要按照文档配置一下，就可以了，并不需要删除这个插件。

## 总结

`Vim` 这个编辑器使用体验就跟使用 `Linux` 发行版差不多，我们无法保证不出错，但是真的沉下心去研究，也没有什么能难倒我们的。在经历了配置和装插件的过程之后，真正我让长期花时间的，反而是熟悉 VIM 里基本的编辑操作，训练肌肉记忆。反而之前添加了不少键绑定和配置后来觉得也没有配置的必要，就去掉了。
